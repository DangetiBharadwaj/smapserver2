    Header always set Strict-Transport-Security: "max-age=31536000; includeSubDomains"
    Header always set X-Frame-Options "SAMEORIGIN"
     Header set Content-Security-Policy "default-src 'self' 'unsafe-inline' *.google.com *.googleapis.com *.openstreetmap.org *.openstreetmap.fr api.mapbox.com a.tiles.mapbox.com *.gstatic.com blob: data:;"
    
    ProxyPass         /webForm ajp://localhost:8009/surveyMobileAPI/rest/webForm
    ProxyPassReverse  /webForm ajp://localhost:8009/surveyMobileAPI/rest/webForm
    ProxyPass         /app/myWork/webForm ajp://localhost:8009/surveyMobileAPI/rest/webForm
    ProxyPassReverse  /app/myWork/webForm ajp://localhost:8009/surveyMobileAPI/rest/webForm
    
    ProxyPass         /formList ajp://localhost:8009/surveyMobileAPI/rest/formList
    ProxyPassReverse  /formList ajp://localhost:8009/surveyMobileAPI/rest/formList
    ProxyPass         /formXML ajp://localhost:8009/surveyMobileAPI/rest/formXML
    ProxyPassReverse  /formXML ajp://localhost:8009/surveyMobileAPI/rest/formXML
    ProxyPass         /instanceXML ajp://localhost:8009/surveyMobileAPI/rest/instanceXML
    ProxyPassReverse  /instanceXML ajp://localhost:8009/surveyMobileAPI/rest/instanceXML
    ProxyPass         /submission ajp://localhost:8009/surveyMobileAPI/rest/submission connectiontimeout=60 timeout=600
    ProxyPassReverse  /submission ajp://localhost:8009/surveyMobileAPI/rest/submission
    ProxyPass         /xformsManifest ajp://localhost:8009/surveyMobileAPI/rest/xformsManifest
    ProxyPassReverse  /xformsManifest ajp://localhost:8009/surveyMobileAPI/rest/xformsManifest
    ProxyPass         /htmlManifest ajp://localhost:8009/surveyMobileAPI/rest/htmlManifest
    ProxyPassReverse  /htmlManifest ajp://localhost:8009/surveyMobileAPI/rest/htmlManifest
    ProxyPass         /action ajp://localhost:8009/surveyMobileAPI/rest/action
    ProxyPassReverse  /action ajp://localhost:8009/surveyMobileAPI/rest/action
    ProxyPass         /lookup ajp://localhost:8009/surveyMobileAPI/rest/lookup
    ProxyPassReverse  /lookup ajp://localhost:8009/surveyMobileAPI/rest/lookup
    ProxyPass         /login ajp://localhost:8009/surveyMobileAPI/rest/login
    ProxyPassReverse  /login ajp://localhost:8009/surveyMobileAPI/rest/login
    ProxyPass         /custom ajp://localhost:8009/surveyMobileAPI/rest/custom
    ProxyPassReverse  /custom ajp://localhost:8009/surveyMobileAPI/rest/custom

    
    # Set a timeout of 10 minutes on media upload requests
    ProxyPass         /surveyKPI/upload/media ajp://localhost:8009/surveyKPI/rest/upload/media timeout=600
    ProxyPassReverse  /surveyKPI/upload/media ajp://localhost:8009/surveyKPI/rest/upload/media
    ProxyPass         /surveyKPI/assignments/load ajp://localhost:8009/surveyKPI/rest/assignments/load timeout=600
    ProxyPassReverse  /surveyKPI/assignments/load ajp://localhost:8009/surveyKPI/rest/assignments/load

    ProxyPass         /surveyKPI/monitoring ajp://localhost:8009/surveyKPI/monitoring
    ProxyPassReverse  /surveyKPI/monitoring ajp://localhost:8009/surveyKPI/monitoring   
    ProxyPass         /monitoring ajp://localhost:8009/surveyMobileAPI/monitoring
    ProxyPassReverse  /monitoring ajp://localhost:8009/surveyMobileAPI/monitoring
    ProxyPass         /api/monitoring ajp://localhost:8009/koboToolboxApi/monitoring
    ProxyPassReverse  /api/monitoring ajp://localhost:8009/koboToolboxApi/monitoring   
    
    ProxyPass         /surveyKPI ajp://localhost:8009/surveyKPI/rest
    ProxyPassReverse  /surveyKPI ajp://localhost:8009/surveyKPI/rest

    ProxyPass         /api ajp://localhost:8009/koboToolboxApi/api
    ProxyPassReverse  /api ajp://localhost:8009/koboToolboxApi/api

    ErrorDocument 403 /errors/403.html
    ErrorDocument 404 /errors/404.html
    ErrorDocument 405 /errors/405.html
    ErrorDocument 500 /errors/500.html

#
# 1. Provide access to home page
# 2. Basic authentication for API access - TODO replace with API token
# 3. GUI access protected by mod auth form
# 4. Mod auth form locations
    
# 1. Provide access to home page
    
    <Directory />
    	Require all denied
    </Directory>

    <Directory /var/www/smap>
    	Options FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>
	
    <Location />
        Require all granted
    </Location>

# 2. Basic authentication for API access

    <Location /api>
        AuthType Basic
        AuthName "smap"
        AuthBasicUseDigestAlgorithm MD5
        AuthBasicProvider dbd
        AuthDBDUserRealmQuery "select password from users where ident = %s and realm = %s"
        Require valid-user
         
        FileETag None
        Header unset ETag
        Header set Cache-Control "max-age=0, no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires "Wed, 11 Jan 1984 05:00:00 GMT"
    </Location>

     <Location /formList>
     	AuthType Basic
        AuthName "smap"
        AuthBasicUseDigestAlgorithm MD5
        AuthBasicProvider dbd
        AuthDBDUserRealmQuery "select password from users where ident = %s and realm = %s"
        Require valid-user
     </Location>

    <Location /formXML>
     	AuthType Basic
        AuthName "smap"
        AuthBasicUseDigestAlgorithm MD5
        AuthBasicProvider dbd
        AuthDBDUserRealmQuery "select password from users where ident = %s and realm = %s"
       	Require valid-user
    </Location>

    <Location /instanceXML>
        AuthType Basic
        AuthName "smap"
        AuthBasicUseDigestAlgorithm MD5
        AuthBasicProvider dbd
        AuthDBDUserRealmQuery "select password from users where ident = %s and realm = %s"
        Require valid-user
    </Location>

    <Location /submission>
    	AuthType Basic
        AuthName "smap"
        AuthBasicUseDigestAlgorithm MD5
        AuthBasicProvider dbd
        AuthDBDUserRealmQuery "select password from users where ident = %s and realm = %s"
        Require valid-user
    </Location>

    <Location /xformsManifest>
	AuthType Basic
        AuthName "smap"
        AuthBasicUseDigestAlgorithm MD5
        AuthBasicProvider dbd
        AuthDBDUserRealmQuery "select password from users where ident = %s and realm = %s"
       	Require valid-user
    </Location>

    <Location /htmlManifest>
	AuthType Basic
        AuthName "smap"
        AuthBasicUseDigestAlgorithm MD5
        AuthBasicProvider dbd
        AuthDBDUserRealmQuery "select password from users where ident = %s and realm = %s"
        Require valid-user
    </Location>

    <Location /lookup>
        AuthType Basic
        AuthName "smap"
        AuthBasicUseDigestAlgorithm MD5
        AuthBasicProvider dbd
        AuthDBDUserRealmQuery "select password from users where ident = %s and realm = %s"
        Require valid-user
    </Location>

    # login used by fieldTask
    <Location /login>
        AuthType Basic
        AuthName "smap"
        AuthBasicUseDigestAlgorithm MD5
        AuthBasicProvider dbd
        AuthDBDUserRealmQuery "select password from users where ident = %s and realm = %s"
        Require valid-user
    </Location>

# 3. GUI access protected by mod auth form

    <Location /app>
        AuthType Form
        AuthName "smap"
        Require valid-user

        AuthBasicUseDigestAlgorithm MD5
        AuthBasicProvider dbd
        AuthDBDUserRealmQuery "select password from users where ident = %s and realm = %s"

        Session on
        SessionCookieName session path=/
        AuthFormLoginRequiredLocation "/login.html"
    </Location>

    <Location /edit.html>
        AuthType Form
        AuthName "smap"
        Require valid-user

        AuthBasicUseDigestAlgorithm MD5
        AuthBasicProvider dbd
        AuthDBDUserRealmQuery "select password from users where ident = %s and realm = %s"

        Session on
        SessionCookieName session path=/
        AuthFormLoginRequiredLocation "/login.html"
    </Location>

    <Location /dashboard>
        AuthType Form
        AuthName "smap"
        Require valid-user

        AuthBasicUseDigestAlgorithm MD5
        AuthBasicProvider dbd
        AuthDBDUserRealmQuery "select password from users where ident = %s and realm = %s"

        Session on
        SessionCookieName session path=/
        AuthFormLoginRequiredLocation "/login.html"
    </Location>

    # TODO some API calls use surveyKPI
    <Location /surveyKPI>
        AuthType Form
        AuthName "smap"
        Require valid-user

        AuthBasicUseDigestAlgorithm MD5
        AuthBasicProvider dbd
        AuthDBDUserRealmQuery "select password from users where ident = %s and realm = %s"

        Session on
        SessionCookieName session path=/
        AuthFormLoginRequiredLocation "/unauthorised.json"
    </Location>

    <Location /api/v1/data/server>
        AuthType Form
        AuthName "smap"
        Require valid-user

        AuthBasicUseDigestAlgorithm MD5
        AuthBasicProvider dbd
        AuthDBDUserRealmQuery "select password from users where ident = %s and realm = %s"

        Session on
        SessionCookieName session path=/
        AuthFormLoginRequiredLocation "/unauthorised.json"
    </Location>

    <Location /api/v1/data/similar>
        AuthType Form
        AuthName "smap"
        Require valid-user

        AuthBasicUseDigestAlgorithm MD5
        AuthBasicProvider dbd
        AuthDBDUserRealmQuery "select password from users where ident = %s and realm = %s"

        Session on
        SessionCookieName session path=/
        AuthFormLoginRequiredLocation "/unauthorised.json"
    </Location>

    <Location /api/v1/data/changes>
        AuthType Form
        AuthName "smap"
        Require valid-user

        AuthBasicUseDigestAlgorithm MD5
        AuthBasicProvider dbd
        AuthDBDUserRealmQuery "select password from users where ident = %s and realm = %s"

        Session on
        SessionCookieName session path=/
        AuthFormLoginRequiredLocation "/unauthorised.json"
    </Location>

    <Location /custom>
        AuthType Form
        AuthName "smap"
        Require valid-user

        AuthBasicUseDigestAlgorithm MD5
        AuthBasicProvider dbd
        AuthDBDUserRealmQuery "select password from users where ident = %s and realm = %s"

        Session on
        SessionCookieName session path=/
        AuthFormLoginRequiredLocation "/unauthorised.json"
    </Location>

# 4. Mod auth form locations

    <Location /login.html>
        Require all granted
    </location>

    <Location /dologin.html>
        Require all granted

        SetHandler form-login-handler
        AuthType form
        AuthName smap

        AuthBasicUseDigestAlgorithm MD5
        AuthFormProvider dbd
        AuthDBDUserPWQuery "select password from users where ident = %s"

        AuthFormLoginRequiredLocation "/login.html?error=yes"
        AuthFormLoginSuccessLocation /index.html

        Session On
        SessionCookieName session path=/
    </Location>

    <Location /authenticate/login.txt>
        AuthType Form
        AuthName "smap"
        Require valid-user

        AuthBasicUseDigestAlgorithm MD5
        AuthFormProvider dbd
        AuthDBDUserPWQuery "select password from users where ident = %s"

        Session on
        SessionCookieName session path=/
        AuthFormLoginRequiredLocation "/unauthorised.json"
    </Location>

    <Location /authenticate/requestlogin.txt>
        AuthType Form
        AuthName "smap"
        Require valid-user

        AuthBasicUseDigestAlgorithm MD5
        AuthFormProvider dbd
        AuthDBDUserPWQuery "select password from users where ident = %s"

        Session on
        SessionCookieName session path=/
        AuthFormLoginRequiredLocation "/login.html"
    </Location>

    <Location /dologout.html>
        Require all granted

        SetHandler form-logout-handler
        AuthName smap
        AuthFormLogoutLocation "/logout.html"
        Session On
        SessionCookieName session path=/
    </Location>

# Everything below here work in progress  WIP
    <Location /logout.html>
        Require all granted
    </location>

    <Location /app/forgottenPassword.html>
        Require all granted
    </Location>

    <Location /register.html>
        Require all granted
    </Location>

# Protected by Key

    <Location /app/myWork/webForm/key>
      	Require all granted 
    </Location>
    
    <Location /app/myWork/webForm/id>
      	Require all granted 
    </Location>
    
    <Location /app/myWork/webForm/action>
      	Require all granted 
    </Location>
    
    <Location /submission/key>
	Require all granted
    </Location>

    <Location /custom/banner>
        Require all granted
    </Location>

    <Location /surveyKPI/user/details/key>
        Require all granted
    </Location>

    <Location /surveyKPI/log/key>
        Require all granted
    </Location>
    
    <Location /surveyKPI/myassignments/key>
    	Require all granted
    </Location>

    <Location /register.html>
        Require all granted
    </Location>

    <Location /surveyKPI/register>
	Require all granted
    </Location>

    # Request password reset
    <Location /surveyKPI/onetimelogon>
	Require all granted
    </Location>

    # Subscribe - unsubscribe
    <Location /surveyKPI/subscriptions>
	Require all granted
    </Location>

# Deny access to deprecated services

    <Location /surveyKPI/deprecated>
	Require all denied
    </Location>

# unprotected

    <Directory /smap/css>
        Require all granted
    </Directory>

     <Location /js>
	Require all granted
     </location>

    <Location /favicon.ico>
        Require all granted
    </Location>

    <Location /OpenLayers>
	Require all granted
    </location>

     <Location /fieldManager/js>
	Require all granted
     </location>

    <Location /surveyKPI/file/id>
	Require all granted
    </Location>

